<!-- no generalization, simplified -->
<script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
<!-- todo: blockly -->
<div id="add_quest">
    <label for="name">quest name</label>
    <br>
    <textarea id="q_name" name="name"></textarea>
    <br>
    <label for="q_id">quest id. that's a tag under which it is saved</label>
    <br>
    <textarea id="q_id" name="id"></textarea>
    <br>
    <label for="whatdo">what do?</label>
    <br>
    <textarea id="q_whatdo" name="whatdo"></textarea>
    <br>
    <label for="trigger">trigger.  </label>
    <br>
    <input type="text" list="q_trigger" name="trigger">
    <datalist id="q_trigger">
        <option value="todo: fetch triggers">
    </datalist>
    <button onclick="q_load_triggers()">Load triggers</button>
    <br>
    <input type="checkbox" id="q_legal_check">
    <label>Legal enforcement</label>
    <br>
    <button onclick="q_submit()">Submit</button>

</div>
<div id="my_quests">
    <label for="my_quests">My Quests</label>
    <textarea id="my_quests" name="my_quests"></textarea>
    <br>
    <button onclick="q_show()">Show quests</button>
</div>

<script id="js_quest_core">
    var gun = new Gun();
    ;(()=>{//sample triggers
        gun.get("triggers").map().once((e)=>{gun.get("triggers").get(e).put(null)})
        gun.get("triggers").get("1").put({"key":"1_key","value":"1_value"})
        gun.get("triggers").get("0").put({"key":"0_key","value":"0_value"})
    })();
    function q_load_triggers(){
        var datalist = document.getElementById("q_trigger")
        var array =[]
        gun.get("triggers").map((e)=>array.push(e))
        console.log(array)
        var options=''
        array.forEach((j)=>{      
            options += '<option value="' + j.value + '" />';
        })
        datalist.innerHTML=options;
    }
    function q_submit(){
        var whatdo = document.getElementById("q_whatdo").value
        var q_name = document.getElementById("q_name").value
        var q_id = document.getElementById("q_id").value
        gun.get("quests").get(q_id).put({"type":"simple","whatdo":whatdo,"q_name":q_name})
    }
    function q_show(){
        let version="1"
        let retval={}
        gun.get("quests").get(version).map().once((arg)=>{

            console.log(arg)
        })
        // gun.get("quests").once(console.log)
    }
</script>