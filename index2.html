<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>MayGame</title>
  <meta name="description" content="No description">
  <meta name="author" content="Some dude">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script id="gun_cdn_script" src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script id="sea_cdn_script" src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
  <script id="wsjs_innerscript" src="js/core/wsjs.js"></script>
  <link id="css_styles_core" rel="stylesheet" href="css/styles.css" />
  <link id="css_bootstrap_min" rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
</head>
<body id="dev2_body">
    <div id="dev2_div"></div>
    <script id="device_js">
        var gun = new Gun("https://vine-mature-morocco.glitch.me/gun");
        var sea = Gun.SEA
        var user = gun.user()
        var this_device="device2";
        var key = {"pub":"8zkWXFT6Qe9RKQ8l93IflY_w2CRz5oX2o1j6FCL36BY.WTdOwlnHfIkKxYV6LlOTtrBE4uD-9PPSQlNxcK9Cit8","priv":"S1iBnLH4Y0vnl72EWcV1wb91p5Ufy0FsDQ7o9ageNkc","epub":"Hmtozeo-xeNjaTcl9CPYf1kFH90Hg5KQt9L_oKKvL1U.gPYL1WQNI5_0UZ-fCyhT_EN-lFpzezC7fB8LjRGQD6g","epriv":"HbIViA2JjfJauUL_ziDrFNar3LVZxJgJHkvh751kkiM"}
        async function dev_init() {
            user.auth(key);
            render_sub_topic('test',dev2_div);
            await user.get("test").get("devices").get(this_device).get('test_js').on((data, key)=>{
                target.innerText=data;
            })
            await user.get("test").get("devices").get(this_device).get('scripts').map().on((data, key)=>{
          var scr = document.getElementById(key);
          if(scr){scr.parentNode.removeChild(scr);}
          if(data){
          var newScript = document.createElement("script");
          newScript.type = "text/javascript";
          newScript.innerText=data.text;//.replace(/\n/g, " ");
        //   newScript.innerText=data.text.replace(/<br>/g, " ");
          newScript.id=key;
          document.body.appendChild(newScript);
        }
      })

        }
        setTimeout(dev_init,1000)

        function render_sub_topic(topic,target){//target - element
        user.get("test").get("devices").get(this_device).get(topic).on((data, key)=>{
            target.innerHTML=data;
            console.log(data);
        })
      }

      
    </script>
    <script id="target"></script>

</body>
</html>